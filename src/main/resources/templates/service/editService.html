<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org/">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit Service</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
<div class="container">
  <h1>Chỉnh sửa dịch vụ : <span th:text="${service.serviceName}+'(ID :'+ ${service.serviceId}+')'"></span></h1>
  <hr>
  <div class="row">
    <!-- left column -->
    <div class="col-md-3">
      <div class="text-center">
        <img th:src="@{/images/{filename}(filename=${service.img})}" class="avatar img-circle" alt="avatar" width="100px">
        <h6>Upload a different photo...</h6>
        <form id="imgForm">
          <input type="file" class="form-control" id="img">
          <input type="submit" class="btn btn-primary mt-2" value="Lưu ảnh" >
        </form>


      </div>
    </div>

    <!-- edit form column -->
    <div class="col-md-9 personal-info">
      <h3>Thông tin dịch vụ</h3>

      <form class="form-horizontal" method="post"  id="serviceForm">
        <input type="hidden" id ="serviceId" name="serviceId" th:value="${service.serviceId} "/>
        <div class="form-group">
          <label class="col-lg-3 control-label">Tên dịch vụ:</label>
          <div class="col-lg-8">
            <input class="form-control" type="text" th:value="${service.serviceName} " name="serviceName" id = "serviceName">
          </div>
        </div>
        <div class="form-group">
          <label class="col-lg-3 control-label">Mô tả chi tiết:</label>
          <div class="col-lg-8">
            <textarea class="form-control" type="text" id="detail" name="detail" th:text="${service.detail} "></textarea>
          </div>
        </div>
        <div class="form-group">
          <label class="col-lg-3 control-label">Giá dịch vụ:</label>
          <div class="col-lg-8">
            <input class="form-control" type="text" id="price" name="price"  th:value="${service.price} ">
          </div>
        </div>
        <div class="form-group">
          <label class="col-lg-3 control-label">Chất liệu:</label>
          <div class="col-lg-8">
            <input class="form-control" type="text" id="material" name="material"  th:value="${service.material} ">
          </div>
        </div>
        <div class="form-group">
          <label class="col-lg-3 control-label">Bảo hành:</label>
          <div class="col-lg-8">
            <input class="form-control" id="guarantee" name="guarantee"  th:value="${service.guarantee} ">
          </div>
        </div>
        <div class="form-group">
          <label class="col-lg-3 control-label">Trạng thái:</label>
          <div class="col-lg-8">
            <select class="form-select" id="isActive" name="isActive">
              <option value="true"  th:selected="${service.isActive}">Kích hoạt</option>
              <option value="false"  th:selected="${not service.isActive}"> Tạm ngưng</option>
            </select>
          </div>
        </div>


        <div class="form-group">
          <label class="col-md-3 control-label"></label>
          <div class="col-md-8">
            <input type="submit" class="btn btn-primary" value="Save Changes">
            <span></span>
            <a th:href="@{/admin/manageService}" class="btn btn-secondary">Cancel</a>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
<hr>
<!--<div class="container">-->
<!--  <h1>Chỉnh sửa dịch vụ : <span th:text="${service.serviceName}+'(ID :'+ ${service.serviceId}+')'"></span></h1>-->
<!--  <form method="post"  id="serviceForm">-->
<!--    <div class="mb-3">-->
<!--      <div class="form-group">-->
<!--        <label for="imageInput" class="form-label">Ảnh minh họa</label>-->

<!--        &lt;!&ndash; Hiển thị ảnh hiện tại &ndash;&gt;-->
<!--        <div id="currentImageContainer" style="text-align: center;">-->
<!--          <img id="currentImage" th:src="@{/img/{img}(img=${service.img})}" alt="Ảnh hiện tại" style="max-width: 50%; height: auto;">-->
<!--          <div id="currentImageHelp" class="form-text">Ảnh hiện tại</div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Input tải lên ảnh mới &ndash;&gt;-->
<!--        <input type="file" name="img" class="form-control" id="imageInput" accept="image/*" onchange="previewImage()">-->

<!--        &lt;!&ndash; Container cho ảnh xem trước &ndash;&gt;-->
<!--        <div id="imagePreviewContainer" style="display: none; text-align: center;">-->
<!--          <br>-->
<!--          <img id="imagePreview" alt="Ảnh xem trước" style="max-width: 50%; height: auto;">-->
<!--          <div id="serviceImageHelp" class="form-text">Ảnh xem trước</div>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->
<!--    <div class="mb-3">-->
<!--      <label for="serviceName" class="form-label">Service Name</label>-->
<!--      <input type="text" id="serviceName" name="serviceName" class="form-control" th:value="${service.serviceName} " required/>-->
<!--    </div>-->

<!--    <div class="mb-3">-->
<!--      <label for="detail" class="form-label">Detail</label>-->
<!--      <textarea class="form-control" id="detail" name="detail" th:text="${service.detail} " required></textarea>-->
<!--    </div>-->

<!--    <div class="mb-3">-->
<!--      <label for="price" class="form-label">Price</label>-->
<!--      <input type="number" class="form-control" id="price" name="price"  th:value="${service.price} " required/>-->
<!--    </div>-->

<!--    <div class="mb-3">-->
<!--      <label for="material" class="form-label">Material</label>-->
<!--      <input type="text" class="form-control" id="material" name="material"  th:value="${service.material} " />-->
<!--    </div>-->

<!--    <div class="mb-3">-->
<!--      <label for="guarantee" class="form-label">Guarantee</label>-->
<!--      <input type="text" class="form-control" id="guarantee" name="guarantee"  th:value="${service.guarantee} " />-->
<!--    </div>-->

<!--    <div class="mb-3">-->
<!--      <label>Status:</label>-->
<!--      <select class="form-select" id="isActive" name="isActive">-->
<!--        <option value="true"  th:selected="${service.isActive}">Kích hoạt</option>-->
<!--        <option value="false"  th:selected="${not service.isActive}"> Tạm ngưng</option>-->
<!--      </select>-->
<!--    </div>-->

<!--    <button type="submit" class="btn btn-primary">Update</button>-->
<!--    <a href="/admin/manageService" class="btn btn-secondary">Cancel</a>-->
<!--  </form>-->
<!--</div>-->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  const swalWithBootstrapButtons = Swal.mixin({
    customClass: {
      confirmButton: "btn btn-success",
      cancelButton: "btn btn-danger"
    },
    buttonsStyling: false
  });
  document.getElementById('serviceForm').addEventListener('submit', async (event) => {
    event.preventDefault();
    const serviceName = document.getElementById('serviceName').value;
    const serviceId = document.getElementById('serviceId').value;
    const price = document.getElementById('price').value;
    const detail = document.getElementById('detail').value;
    const material = document.getElementById('material').value;
    const guarantee = document.getElementById('guarantee').value;
    const isActive = document.getElementById('isActive').value;
    console.log("isActive: "+isActive);

    // Lấy dữ liệu từ các trường input
    const formData = new FormData();
    formData.append('serviceId', serviceId);
    formData.append('serviceName', serviceName);
    formData.append('price', price);
    formData.append('isActive', isActive);
    formData.append('material', material);
    formData.append('guarantee', guarantee);
    formData.append('detail', detail);

    try {
      const response = await fetch('/service/updateService', {
        method: 'POST',
        body: formData
      });

      if (response.ok) {
        swalWithBootstrapButtons.fire({
          title: "Thành công!",
          text: "Sửa dịch vụ thành công",
          icon: "success"
        }).then(() => {
          // Reload the page
          location.reload();
        });
      } else {
        Swal.fire({
          icon: "error",
          title: "Oops...",
        })
      }
    } catch (error) {
      // Xử lý lỗi kết nối
      console.error('Lỗi kết nối:', error);
    }
  });
  document.getElementById('imgForm').addEventListener('submit', async (event) => {
    event.preventDefault();
    const serviceId= document.getElementById('serviceId').value.trim();
    const imgInput = document.getElementById('img');
    console.log("imgInput:"+imgInput);
    const imgFile = imgInput.files[0];
    console.log("imgFile:"+imgFile);

    // Lấy dữ liệu từ các trường input
    const formData = new FormData();
    formData.append('serviceId', serviceId);
    formData.append('img', imgFile);

    try {
      const response = await fetch('/service/updateImg', {
        method: 'POST',
        body: formData
      });

      if (response.ok) {
        swalWithBootstrapButtons.fire({
          title: "Thành công!",
          text: "Cập nhật ảnh thành công",
          icon: "success"
        }).then(() => {
          // Reload the page
          location.reload();
        });
      } else {
        Swal.fire({
          icon: "error",
          title: "Oops...",
        })
      }
    } catch (error) {
      // Xử lý lỗi kết nối
      console.error('Lỗi kết nối:', error);
    }
  });

  function previewImage() {
    const fileInput = document.getElementById('imageInput');
    const previewContainer = document.getElementById('imagePreviewContainer');
    const currentImageContainer = document.getElementById('currentImageContainer');
    const imagePreview = document.getElementById('imagePreview');

    // Kiểm tra xem có file được chọn không
    if (fileInput.files && fileInput.files[0]) {
      const reader = new FileReader();

      // Khi file được đọc, cập nhật src của ảnh xem trước
      reader.onload = function (e) {
        imagePreview.src = e.target.result;
        previewContainer.style.display = 'block'; // Hiển thị container
        currentImageContainer.style.display = 'none'; // Ẩn ảnh hiện tại
      };

      // Đọc file ảnh
      reader.readAsDataURL(fileInput.files[0]);
    } else {
      previewContainer.style.display = 'none'; // Ẩn container nếu không có file
      currentImageContainer.style.display = 'block'; // Hiển thị ảnh hiện tại nếu không có file mới
    }
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

</body>
</html>
