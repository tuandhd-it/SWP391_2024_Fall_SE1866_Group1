<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org/">
<head>
  <meta charset="UTF-8">
  <title>Manage Employee</title>
  <link href="https://cdn.lineicons.com/4.0/lineicons.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <!-- Option 1: Include in HTML -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
  <link rel="stylesheet" th:href="@{/css/dashboard.css}">

</head>
<body>
<div class="d-flex">
  <aside th:replace="~{/layout/dashboardNav :: sidebar}"></aside>
  <div class="main">
    <nav th:replace="~{/layout/dashboardHeader :: header}"></nav>
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-12 profile">
          <h1>
            Danh sách dịch vụ
          </h1>
          <form class="input-group row">
            <!-- Sort Type Dropdown -->
            <div class="col-md-2">
              <select class="form-select" id="sortType" name="sort" aria-label="Sort By">
                <option value="idAsc" th:selected="${sort == 'idAsc'}">Bộ lọc</option>
                <option value="nameAsc" th:selected="${sort == 'nameAsc'}">Tên Tăng Dần</option>
                <option value="nameDesc" th:selected="${sort == 'nameDesc'}">Tên Giảm Dần</option>
                <option value="priceAsc" th:selected="${sort == 'priceAsc'}">Giá Tăng Dần</option>
                <option value="priceDesc" th:selected="${sort == 'priceDesc'}">Giá Giảm Dần</option>
              </select>
            </div>

            <!-- Search Type Dropdown -->
            <div class="col-md-3">
              <select class="form-select" id="searchType" aria-label="Search Type" name="searchType">
                <option value="name" th:selected="${searchType == 'name'}">Tìm kiếm theo tên</option>
                <option value="id" th:selected="${searchType == 'id'}">Tìm kiếm theo ID</option>
              </select>
            </div>

            <!-- Search Input -->
            <input class="form-control col-md-4" type="search" placeholder="Nhập tên dịch vụ" aria-label="Search" id="searchInput" name="search" th:placeholder="${searchType == 'id'} ? 'Nhập ID dịch vụ' : 'Nhập tên dịch vụ'" th:value="${search}">

            <!-- Search Button -->
            <button class="btn btn-outline-success col-md-3" type="submit">Tìm kiếm</button>
          </form>
            <table class="table table-bordered table-hover mt-3">
              <thead class="table-dark">
                <tr>
                  <th style="width: 10%;">ID</th>
                  <th style="width: 30%;">Tên dịch vụ</th>
                  <th style="width: 20%;">Giá</th>
                  <th style="width: 15%;">Trạng thái</th>
                  <th style="width: 25%;">Tùy chỉnh</th>
                </tr>
              </thead>
              <tbody>
              <tr th:each="ser : ${listService}">
                <td th:text="${ser.serviceId}"></td>
                <td th:text="${ser.serviceName}"></td>
                <td th:text="${ser.price}"></td>
                <td>
                  <div style="display: flex" th:switch="${ser.isActive}">

                      <button th:case="${true}" type="button" class="btn btn-success" style="padding: 5px; margin: 5px" th:value="${ser.serviceId}">Kích hoạt</button>

                      <button th:case="${false}" type="button" class="btn btn-warning" style="padding: 5px;margin: 5px" th:value="${ser.serviceId}">Tạm ngưng</button>
                  </div>

                </td>
                <td>
                  <span class="table-action-icons">
                      <button type="button" class="btn btn-link p-0">
                        <i class="bi bi-eye"></i>
                      </button >
                      <button type="button" class="btn btn-link p-0">
                        <i class="bi bi-pencil-square"></i>
                      </button>
                  </span>
                </td>

              </tr>
              </tbody>
            </table>
          <nav aria-label="Page navigation example">
            <ul class="pagination justify-content-center">
              <!-- Previous button -->
              <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
                <a class="page-link" th:href="@{/admin/manageService(page=${currentPage - 1}, search=${search}, sort=${sort})}" tabindex="-1">Previous</a>
              </li>

              <!-- Pagination Numbers -->
              <li class="page-item" th:each="i : ${#numbers.sequence(1, totalPages)}"
                  th:classappend="${currentPage == i} ? 'active'">
                <a class="page-link" th:href="@{/admin/manageService(page=${i}, search=${search}, sort=${sort})}" th:text="${i}">1</a>
              </li>

              <!-- Next button -->
              <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
                <a class="page-link" th:href="@{/admin/manageService(page=${currentPage + 1}, search=${search}, sort=${sort})}">Next</a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<script>
  document.getElementById('searchType').addEventListener('change', function() {
    const searchInput = document.getElementById('searchInput');
    if (this.value === 'id') {
      searchInput.placeholder = 'Nhập ID dịch vụ';
    } else {
      searchInput.placeholder = 'Nhập tên dịch vụ';
    }
  });
  const banButtons = document.querySelectorAll('.btn-success');
  const inactiveButtons = document.querySelectorAll('.btn-warning');

  const swalWithBootstrapButtons = Swal.mixin({
    customClass: {
      confirmButton: "btn btn-success",
      cancelButton: "btn btn-danger"
    },
    buttonsStyling: false
  });
  banButtons.forEach(function (button) {
    button.addEventListener('click', function () {
      const id = this.getAttribute('value');

      swalWithBootstrapButtons.fire({
        title: "Bạn có muốn tạm ngưng dịch vụ không ?",
        text: "Tạm ngưng dịch vụ với ID: " + id + "!",
        icon: "warning",
        showCancelButton: true,
        confirmButtonText: "Đồng ý!",
        cancelButtonText: "Hủy!",
        dangerMode: true,
      }).then((result) => {
        if (result.isConfirmed) {
          banService(id);
        } else {
          swalWithBootstrapButtons.fire({
            title: "Cancelled",
            icon: "error"
          });
        }
      });
    });
  });

  inactiveButtons.forEach(function (button) {
    button.addEventListener('click', function () {
      const id = this.getAttribute('value');

      swalWithBootstrapButtons.fire({
        title: "Bạn có muốn kích hoạt ?",
        text: "Kích hoạt dịch vụ với ID: " + id + "!",
        icon: "success",
        showCancelButton: true,
        confirmButtonText: "  Đồng ý!  ",
        cancelButtonText: "  Hủy!  ",
        dangerMode: false,
      }).then((result) => {
        if (result.isConfirmed) {
          activateService(id);
        } else {
          swalWithBootstrapButtons.fire({
            title: "Cancelled",
            icon: "error"
          });
        }
      });
    });
  });

  function banService(id) {
    fetch('/service/ban', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
      },
      body: 'id=' + encodeURIComponent(id)
    }).then(response => {
      if (response.ok) {
        swalWithBootstrapButtons.fire({
          title: "Thành công!",
          text: "Tạm ngưng dịch vụ thành công",
          icon: "success"
        })
                .then(() => {
                  location.reload();
                });
      } else {
        Swal.fire("Please try again later.");
      }
    }).catch(error => {
      swal("Please try again later.");
    });
  }

  function activateService(id) {
    fetch('/service/activate', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
      },
      body: 'id=' + encodeURIComponent(id)
    }).then(response => {
      if (response.ok) {
        swalWithBootstrapButtons.fire({
          title: "Thành công!",
          text: "Kích hoạt dịch vụ thành công",
          icon: "success"
        })
        .then(() => {
          location.reload();
        });
      } else {
        Swal.fire("Please try again later.");
      }
    }).catch(error => {
      swal("Please try again later.");
    });
  }

</script>
<script th:src="@{/js/dashboard.js}"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script crossorigin="anonymous"
        integrity="sha384-DGnVWbdW9QpJAz/rJHlI6lhQsRbZ7PXfpNOf4eKvcL2ojdCpb/O2IlD5afI7gk/C"
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>